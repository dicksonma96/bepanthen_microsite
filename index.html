<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bepanthen</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header">
        <img src="./assets/header.jpg" alt="">
    </div>
    <div class="bepanthen container col">
        <div class="content col">
            <picture class="banner row">
                <img src="./assets/banner.jpg" alt="Bepanthen Banner">
            </picture>

            <!-- <iframe class="video" src="https://www.youtube.com/embed/j1mF3K8EDqU?si=9w8tBzirYT-jh4Gg">
            </iframe> -->
            <br>
            <a href="https://shp.ee/tfrhztz" target="_blank" class="voucher row">
                <img src="./assets/voucher.png" alt="Bepanthen Voucher">
            </a>

            <!-- <div class="info_banner row">
                <div class="story col">
                    <img src="./assets/story1.jpg" alt="Bepanthen Sensi Wash">
                    <div class="col">
                        <h3>Bepanthen SensiWash</h3>
                        <p>Bepanthen Sensiwash is a gentle yet effective body cleanser for dry, sensitive and
                            eczema-prone
                            skin.</p>
                        <p>Pro-vitamin B5 helps protect the skin by stabilizing the natural skin barrier and supporting
                            the
                            skin’s own regeneration.
                            Enriched with a prebiotic, which supports the skin’s own protective microflora.
                            Suitable for infants, children and adults.
                            Maintains skin’s natural pH.</p>

                        <a href="#" class="cta_btn">READ MORE</a>
                    </div>
                </div>
                <div class="story col">
                    <img src="./assets/story1.jpg" alt="Bepanthen Sensi Wash">
                    <div class="col">
                        <h3>Bepanthen SensiWash</h3>
                        <p>Bepanthen Sensiwash is a gentle yet effective body cleanser for dry, sensitive and
                            eczema-prone
                            skin.</p>
                        <p>Pro-vitamin B5 helps protect the skin by stabilizing the natural skin barrier and supporting
                            the
                            skin’s own regeneration.
                            Enriched with a prebiotic, which supports the skin’s own protective microflora.
                            Suitable for infants, children and adults.
                            Maintains skin’s natural pH.</p>

                        <a href="#" class="cta_btn">READ MORE</a>
                    </div>
                </div>
            </div> -->

            <h2>Mama Try, Skin Smiles</h2>


            <div class="mmcbt_list col">
                <div class="mmcbt_skeleton skeleton"></div>
            </div>


            <h2 style="margin:20px 0 0">Bepanthen Community</h2>
            <h3 style="color:#234d96">#completecarewithbepanthen</h3>

            <div class="ig_skeleton row">
                <div class="skeleton"></div>
                <div class="skeleton"></div>
                <div class="skeleton"></div>
                <div class="skeleton"></div>
                <div class="skeleton"></div>
            </div>
            <div class="ig_grid">
                <!-- to populate ig post -->
            </div>
        </div>
    </div>

    <div class="footer">
        <img src="./assets/footer.jpg" alt="">
    </div>


    <script>
        // Mamacubatry Reviews
        const mmcbt_list = document.querySelector('.mmcbt_list');
        const mmcbt_skeleton = document.querySelector('.mmcbt_skeleton');

        function Review(info) {
            const product_info = info.review;
            const first_review = info.reviews[0] || null;
            const read_more_link = "https://m.motherhood.com.my/mamacubatry-product-detail/" + info.review.link_rewrite

            function Stars(rating) {
                const star = `<img src="./assets/star.png" alt="">`
                const empty = `<img src="./assets/empty_star.png" alt="">`
                const max = 5;
                rating = Math.floor(rating);

                let html = "";
                for (let i = 0; i < max; i++) {
                    html += i < rating ? star : empty;
                }

                return html;
            }

            return `<div class="mmcbt col">
                    <div class="product_info row">
                        <img class="product_img" src="${product_info.product_image}" alt="">
                        <div class="info col">
                            <h3>${product_info.product_name}</h3>
                            <div class="reviews row">
                                <strong>${product_info.overall_rating}</strong>
                                <div class="row stars">
                                ${Stars(product_info.overall_rating)}
                                </div>
                                <span>${product_info.total_review} reviews</span>
                            </div>
                        ${first_review ? `
                            <div class="mmcbt_review col">
                                <div class="user_row row">
                                    <div class="avatar row">${first_review.customer_name[0]}</div>
                                    <span>${first_review.customer_name}</span>

                                    <div class="row stars">
                                             ${Stars(first_review.grade)}
                                    </div>
                                </div>
                                <strong>${first_review.title}</strong>
                                <p>${first_review.content}</p>

                                <a href="${read_more_link}" target="_blank" class="read_more">Read More</a>
                            </div>
                        ` : ``}
                            <a href="https://m.motherhood.com.my/mamacubatry-infopage" target="_blank" class="cta_btn">BE A TESTER NOW</a>
                        </div>
                    </div>
                </div>`
        }

        async function FetchReviews() {

            // Replace the api path from backend here (CORS issue)
            const api_path = "https://m.motherhood.com.my/api/webinar/get_mct_campaign_list?type=review&id_product="

            //Replace the bepanthen products id here
            const products = [
                "bepanthen-baby-ointment-mamacubatry-",
            ]
            try {
                let requestAll = products.map(prod => fetch(api_path + prod))

                let res = await Promise.all(requestAll)
                let datas = await Promise.all(res.map(r => r.json()));

                mmcbt_list.innerHTML = datas.map((data) => {
                    return Review(data.data)
                }).join('')

            }
            catch (e) {
                console.log(e)
            } finally {
                mmcbt_skeleton.style.display = "none";
            }
        }

        FetchReviews();

    </script>

    <script>


        const ig_grid = document.querySelector('.ig_grid');
        const ig_skeleton = document.querySelector('.ig_skeleton');

        function Post(info) {

            const media = info.media_type == "VIDEO" ?
                `<video class="media" src="${info.media_url}"> </video>`
                :
                ` <img class="media"
                        src="${info.media_url}"
                        alt="">`;

            return `<div class="ig_post col">
                    <a href="${info.permalink}" target="_blank" class="ig_btn row">
                        <img src="./assets/instagram.png" alt="">
                    </a>
                    ${media}
                    <em class="hashtag">
                       ${info.caption}
                    </em>
                    <strong>${info.like_count} likes</strong>
                    <span>${info.comments_count} comments</span>
                </div>
                `
        }

        const FetchIGPosts = async () => {
            const appscript_api = "https://script.google.com/macros/s/AKfycbyYkf7MjsjdTSap8BJBxXT0_7ISNKEwkTTGb0wKzHrwPnrDz9M9EgZfoSXjs--QtnQP/exec";

            try {

                let res = await fetch(appscript_api)
                let data = await res.json();
                if (res.ok) {
                    ig_grid.innerHTML = data.map((info) => {
                        return Post(info)
                    }).join('')
                }

            }
            catch (e) {
                console.log(e)
            } finally {
                ig_skeleton.style.display = "none";
            }

        };

        FetchIGPosts();
    </script>


</body>

</html>